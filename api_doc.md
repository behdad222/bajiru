#バジル  -- Bajiru v1.8 API DOC

**Copyright**
**Mohammad Reza Kamalifard**
**Mohammad Javad Abedi**
**Kian Peymani**
**2014-2015.**
**All rights reserved.**

Table of Contents:

[TOC]

----------
# Generate random data
> You can save random data generated by [Mixer] to database. (https://github.com/klen/mixer) This feature is for development use only.
> In terminal execute `deploy.py` with parameter `generatedata`.
> `$ python develop.py generatedata`
>
> In file `project/datagenerate_conf.py`, you can customize your quantity of generated data.

----------

# APIs Usage

##User API
> - User is the one who uses system
> - each user to access views must have the specified role or ability
> -  First time system initialized a user with username **admin** and password **123123** will be created. But before login you should change its password.

###login

Resource URL
>POST
> **/api/v1.8/user/login/**

Resource Information
>|Response formats|Requires authentication?|
|:-:|:-:|
|JSON|NO (must be not authenticated)|

Example Request
```
{
  "username": "admin",
  "password": "123123"
}
```
Example Result
```
{
token:"rl32ld3iOiJIUzI1NiIsfewKKKSLK22yNzkzNTc1NywiaWF0IjoxNDI3OTMyMTU3yIjoiNTUwZTA3OTgzY2MxOTg1NTFlMmY1ZjUxIn0.gJDdXUr7p4nz"
}
```

> **NOTE:**
>
> - If response status code is **401** then you have errors with login.
>- Every error message on response is just for development purpose and not for production. Avoid using response error message body.
> - If response status code is **418** then user should **change** his/her **password** before log in using force user change password API.
> - Access to authentication required resources needs user to be logged in otherwise results **401** response status code.
> - Result is a object contains **TOKEN**.
> - For authentication add TOKEN header to all requests with token this token value.

-------

###Change password for first time at login
Resource URL
>PUT
**/api/v1.8/user/password/**

Resource Information
>|Response formats|Requires authentication?|
|:-:|:-:|
|JSON|NO (must be not authenticated)|

Example Request
```
{
  "username": "admin",
  "old": "123123",
  "new": "321321"
}
```

> **NOTE:**
>
>- In case password changing process is successful the response status code will be **200**.
>- If there are errors like a required field or username doesn't exists response status code will be **406**.
>- If authentication fails response status code will be **401**.

--------
### Current user info

Resource URL
>GET
>**/api/v1.8/user/**

Resource Information
>|Response formats|Requires authentication?|
|:-:|:-:|
|JSON|YES|

Example Result
```
{
  "active": true,
  "address": "میدان صنعت خیابان خوردین شماره ۳۹ پلاک ۲",
  "created_by": "admin",
  "created_on": "2015-03-25 16:33:06",
  "id": "5512e3423cc198af54159118",
  "name": "رضا رسولی",
  "note": "سرپرست رستوران",
  "phone": "88264209",
  "roles": [
    {
      "abilities": [
        "USER_LIST",
        "ROLE_ADD",
        "ROLE_VIEW",
        "ROLE_ASSIGN",
        "USER_EDIT",
        "USER_VIEW",
        "CUSTOMER_LIST",
        "CUSTOMER_VIEW"
      ],
      "name": "سرپرست"
    }
  ],
  "username": "reza123"
}
```
> **NOTE:**
>
> - current user = Current logged in user
> - If user is not logged in response status code will be **401**.
> - Admin is created by null and doesn't have any technical creator.

----
###GET a user report

 >```method: GET```
url: http://baseurl.tld/api/v1.8/user/string:user_id/report/?from=float:from_date&to=float:to_date

response:
```
{
  "orders": [
    "55a558201b070821f36c610a",
    "55a558211b070821f36c6123",
    "55a558211b070821f36c6153",
    "55a558211b070821f36c61b1",
    "55a558211b070821f36c61b4",
    "55a558211b070821f36c61c6",
    "55a558211b070821f36c6224",
    "55a558211b070821f36c6228",
    "55a558221b070821f36c628e"
  ],
  "total_paid_to": 1676316,
  "total_sell": 1596000,
  "user": {
    "id": "55a5581f1b070821f36c5a42",
    "name": "Darius Hintz"
  }
}
```


> **NOTE:**
>
> - user_id the mongo id of a user.
> - from_date and to_date the time stamp of the report range time and should be a number and can be a float number. Default value is current time.
> - Current logged in user should have **USER_REPORT**  ability to use this API otherwise response status code will be **403**.


--------
###Users list with info
Resource URL
>GET 
>**/api/v1.8/user/all/**

Resource Information
>|Response formats|Requires authentication?|Ability|
|:-:|:-:|:-:|
|JSON|YES|USER_LIST|

Example Result
```
{
  "meta": {
    "first": "http://127.0.0.1:5000/api/v1.8/user/all/?per_page=25&page=1",
    "last": "http://127.0.0.1:5000/api/v1.8/user/all/?per_page=25&page=1",
    "next": null,
    "page": 1,
    "pages": 1,
    "per_page": 25,
    "prev": null,
    "total": 2
  },
  "users": [
    {
      "active": true,
      "address": null,
      "created_by": null,
      "created_on": "2015-03-22 00:06:48",
      "id": "550e07983cc198551e2f5f51",
      "name": "مدیر",
      "note": null,
      "phone": null,
      "roles": [
        {
          "abilities": [
            "CUSTOMER_ADD",
            "SETTING_DELETE",
            "ROLE_ADD",
            "ITEM_CATEGORY_EDIT",
            "AGENT_VIEW",
            "ITEM_CATEGORY_DELETE",
            "USER_DELETE",
            "ITEM_LIST",
            "ITEM_DELETE",
            "AGENT_ADD",
            "USER_VIEW",
            "SETTING_LIST"
          ],
          "name": "admin"
        }
      ],
      "username": "admin"
    },
    {
      "active": true,
      "address": "میدان صنعت خیابان خوردین شماره ۳۹ پلاک ۲",
      "created_by": "admin",
      "created_on": "2015-03-25 16:33:06",
      "id": "5512e3423cc198af54159118",
      "name": "رضا رسولی",
      "note": "سرپرست رستوران",
      "phone": "88264209",
      "roles": [
        {
          "abilities": [
            "USER_LIST",
            "ROLE_ADD",
            "ROLE_VIEW",
            "ROLE_ASSIGN",
            "USER_EDIT",
            "USER_VIEW",
            "CUSTOMER_LIST",
            "CUSTOMER_VIEW"
          ],
          "name": "سرپرست"
        }
      ],
      "username": "reza123"
    }
  ]
}
```

> **NOTE:**
> 
> - **Pagination required.**
> - Current logged in user should have a role with **USER_LIST**  ability to use this resource otherwise rejected response status code will be **403**.

-------

###Get a single user info with ID
Resource URL
>GET
> **/api/v1.8/user/```string:pk```/**

> - Replace ```string:pk``` with your specified user id.


Resource Information
>|Response formats|Requires authentication?|Ability|
|:-:|:-:|:-:|
|JSON|YES|USER_VIEW|

Example Result
```
{
  "active": true,
  "address": "میدان صنعت خیابان خوردین شماره ۳۹ پلاک ۲",
  "created_by": "admin",
  "created_on": "2015-03-25 16:33:06",
  "id": "5512e3423cc198af54159118",
  "name": "رضا رسولی",
  "note": "سرپرست رستوران",
  "phone": "88264209",
  "roles": [
    {
      "abilities": [
        "USER_LIST",
        "ROLE_ADD",
        "ROLE_VIEW",
        "ROLE_ASSIGN",
        "USER_EDIT",
        "USER_VIEW",
        "CUSTOMER_LIST",
        "CUSTOMER_VIEW"
      ],
      "name": "سرپرست"
    }
  ],
  "username": "reza123"
}
```
> **NOTE:**
>
> - Current logged in user should have **USER_VIEW**  ability to use this API otherwise response status code will be **403**.

--------

### Add a new user


> ```method: POST```
*url: http://domainname.tld/api/v1.8/user/*

request:
```
{
  "name": "رضا رسولی",
  "password": "123123",
  "note": "جهت انجام کارهای ثبت غذا و حساب داری ",
  "address": "میدان صنعت خیابان خوردین شماره ۳۹ پلاک ۲",
  "phone": "88264209",
  "username": "reza"
}
```
response:
```
{
  "id": "5512bc583cc198a8e6a524f0"
}
```

> **NOTE:**
>
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **USER_ADD**  ability to use this API otherwise response status code will be **403**.
> - If request successful status code will be **201**.
> - Response will be new user id.

--------
### Edit current user info


> ```method: PUT```
*url: http://domainname.tld/api/v1.8/user/*

request:
```

{
  "old": "123123",
  "new": "321321"
}
```

response:
```
{
  "id": "54787533b6851f09ecfdaf62"
}
```

> **NOTE:**
>
> - For now user only can change his password from old to new
> - If there are errors then response status code will be **406**.
> - If old password authentication fails then response status code will be **401**

--------

### Edit a user info


> ```method: PUT```
*url: http://domainname.tld/api/v1.8/user/string:pk/*

request:
```
{
  "new": "321321",
  "name": "bardia",
  "address": "تهران نارمک",
  "phone": "09197386276"
}
```

> **NOTE:**
>
> - All body's parameters are optional
> - If **`new`** exists user's password will be change to `new`'s value.
> - If **`name`** exists user's name will be change to `name`'s value.
> - If **`address`** exists user's address will be change to `address`'s value.
> - If **`phone`** exists user's phone will be change to `phone`'s value.
> - Replace ```string:pk``` with the user id you want to change his info
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **USER_EDIT**  ability to use this API otherwise response status code will be **403**.

--------

### API logout
 >```method: GET```
*url: http://domainname.tld/api/v1.8/user/logout/


--------

##  Role API

###  Add a new role for users


> ```method: POST```
*url: http://domainname.tld/api/v1.8/user/role/*

request:
```
{
  "name": "waiter",
  "abilities": ["ORDER_ADD", "ORDER_VIEW", "ORDER_EDIT", "ORDER_LIST"]
}
```

> **NOTE:**
>
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **ROLE_ADD**  ability to use this API otherwise response status code will be **403**.
> - Get list of available abilities using [get available abilities](#abilities) .

--------

### <a name="abilities"></a> Get list of all available abilities
> ```method: GET```
*url: http://domainname.tld/api/v1.8/user/role/abilities/*

response:
```
{
  "abilities": [
    "CUSTOMER_ADD",
    "SETTING_DELETE",
    "ROLE_ADD",
    "ITEM_CATEGORY_EDIT",
    "AGENT_VIEW",
    "ITEM_CATEGORY_DELETE",
    "USER_DELETE",
    "ITEM_LIST",
    "ITEM_DELETE",
    "ADDRESS_WORD_ADD",
    "ITEM_VIEW",
    "ADDRESS_CATEGORY_VIEW",
    "ADDRESS_CATEGORY_EDIT",
    "SETTING_VIEW",
    "AGENT_EDIT",
    "ROLE_VIEW",
    "ITEM_CATEGORY_VIEW",
    "ROLE_DELETE",
    "CUSTOMER_VIEW",
    "ROLE_EDIT",
    "ADDRESS_CATEGORY_ADD",
    "ADDRESS_CATEGORY_DELETE",
    "ITEM_ADD",
    "ORDER_VIEW",
    "ITEM_EDIT",
    "ITEM_CATEGORY_ADD",
    "ORDER_PRINT",
    "ROLE_ASSIGN",
    "USER_LIST",
    "CUSTOMER_LIST",
    "CUSTOMER_DELETE",
    "SETTING_EDIT",
    "CUSTOMER_EDIT",
    "AGENT_LIST",
    "USER_EDIT",
    "ORDER_EDIT",
    "ORDER_DELETE",
    "ORDER_ADD",
    "ITEM_CATEGORY_LIST",
    "ROLE_LIST",
    "AGENT_DELETE",
    "ROLE_REMOVE",
    "USER_ADD",
    "ORDER_LIST",
    "AGENT_ADD",
    "USER_VIEW",
    "SETTING_LIST"
  ]
}
```

> **NOTE:**
>
> - Current logged in user should have **ROLE_VIEW**  ability to use this API otherwise response status code will be **403**.

--------


### View a role info


> ```method: GET```
*url: http://domainname.tld/api/v1.8/user/role/string:pk/*

response:
```
{
  "abilities": [
    "ORDER_ADD",
    "ORDER_VIEW",
    "ORDER_EDIT",
    "ORDER_LIST"
  ],
  "active": true,
  "created_by": "admin",
  "created_on": "2015-03-13 14:54:16",
  "id": "5502fa181b0708025e092fb5",
  "name": "waiter"
}
```

> **NOTE:**
>
> - Current logged in user should have **ROLE_VIEW**  ability to use this API otherwise response status code will be **403**.
> - Replace string:pk with the role id you want to view.

------

###Get list of all rules with info
> ```method: Get```
*url: http://domainname.tld/api/v1.8/role/*

response:
```
{
  "meta": {
    "first": "http://127.0.0.1:5000/api/v1.8/user/role/?per_page=25&page=1",
    "last": "http://127.0.0.1:5000/api/v1.8/user/role/?per_page=25&page=1",
    "next": null,
    "page": 1,
    "pages": 1,
    "per_page": 25,
    "prev": null,
    "total": 2
  },
  "roles": [
    {
      "abilities": [
        "ORDER_ADD",
        "ORDER_VIEW",
        "ORDER_EDIT",
        "ORDER_LIST"
      ],
      "active": true,
      "created_by": "admin",
      "created_on": "2015-03-13 14:54:16",
      "id": "5502fa181b0708025e092fb5",
      "name": "waiter"
    },
    {
      "abilities": [
        "CUSTOMER_ADD",
        "SETTING_DELETE",
        "ROLE_ADD",
        "ITEM_CATEGORY_EDIT",
        "AGENT_VIEW",
        "ITEM_CATEGORY_DELETE",
        "USER_DELETE",
        "ITEM_LIST",
        "ITEM_DELETE",
        "ADDRESS_WORD_ADD",
        "ITEM_VIEW",
        "ADDRESS_CATEGORY_VIEW",
        "ADDRESS_CATEGORY_EDIT",
        "SETTING_VIEW",
        "AGENT_EDIT",
        "ROLE_VIEW",
        "ITEM_CATEGORY_VIEW",
        "ROLE_DELETE",
        "CUSTOMER_VIEW",
        "ROLE_EDIT",
        "ADDRESS_CATEGORY_ADD",
        "ADDRESS_CATEGORY_DELETE",
        "ITEM_ADD",
        "ORDER_VIEW",
        "ITEM_EDIT",
        "ITEM_CATEGORY_ADD",
        "ORDER_PRINT",
        "ROLE_ASSIGN",
        "USER_LIST",
        "CUSTOMER_LIST",
        "CUSTOMER_DELETE",
        "SETTING_EDIT",
        "CUSTOMER_EDIT",
        "AGENT_LIST",
        "USER_EDIT",
        "ORDER_EDIT",
        "ORDER_DELETE",
        "ORDER_ADD",
        "ITEM_CATEGORY_LIST",
        "ROLE_LIST",
        "AGENT_DELETE",
        "ROLE_REMOVE",
        "USER_ADD",
        "ORDER_LIST",
        "AGENT_ADD",
        "USER_VIEW",
        "SETTING_LIST"
      ],
      "active": true,
      "created_by": null,
      "created_on": "2015-03-13 14:40:14",
      "id": "5502f6ce1b0708025de61454",
      "name": "admin"
    }
  ]
}
```

> **NOTE:**
> 
> - **Pagination required.**
> - Replace int:page with page  number default is 1.
> - Current logged in user should have **ROLE_LIST**  ability to use this API otherwise response status code will be **403**.

--------

###Edit a role


> ```method: PUT```
*url: http://domainname.tld/api/v1.8/user/role/string:pk/*

request:
```
{
  "name": "waiter",
  "abilities": ["ORDER_ADD", "ORDER_VIEW", "ORDER_EDIT", "ORDER_LIST"]
}
```

> **NOTE:**
>
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **ROLE_EDIT**  ability to use this API otherwise response status code will be **403**.
> - Get list of available abilities using [get available abilities](#abilities) .
> - Replace string:pk with the role id you want to view.

--------

###Delete a role


> ```method: DELETE```
*url: http://domainname.tld/api/v1.8/user/role/string:pk/*

> **NOTE:**
>
> - Current logged in user should have **ROLE_DELETE**  ability to use this API otherwise response status code will be **403**.

--------

###Assign a role to user


> ```method: PUT```
*url: http://domainname.tld/api/v1.8/user/role/set/*

request:

```
{
    "user": "id of user",
    "role": "id of role"
}
```

> **NOTE:**
>
> - user id the mongo id of a user you want to assign and role is the role id you want to assign.
> - Current logged in user should have **ROLE_ASSIGN**  ability to use this API otherwise response status code will be **403**.

--------

###Remove a role from user


> ```method: DELETE```
*url: http://domainname.tld/api/v1.8/user/role/set/*

request:

```
{
    "user": "5502f87c1b0708025e092fb4",
    "role": "5502fa181b0708025e092fb5g"
}
```

> **NOTE:**
>
> - user id the mongo id of a user you want to assign and role is the role id you want to assign.
> - Current logged in user should have **ROLE_REMOVE**  ability to use this API otherwise response status code will be **403**.

--------

##Address Category

###Add address category

 >```method: POST```
url: http://baseurl.tld/api/v1.8/customer/address/category/

request:
```
{
  "name": "manteqe 1",
  "cost": 500.450
}
```
response:
```
{
	"id": "gf5g5fgh65h"
}
```

--------------

###Edit address category

 >```method: PUT```
url: http://baseurl.tld/api/v1.8/customer/address/category/`{id}`/

request:
```
{
  "name": "manteqe #2",
  "cost": 553.33
}
```
------------

###Delete address category

 >```method: DELETE```
url: http://baseurl.tld/api/v1.8/customer/address/category/`{id}`/

you will get 204 if succeed. otherwise 404

----
###Get list of all address categories

 >```method: GET```
url: http://baseurl.tld/api/v1.8/customer/address/category/

response:
```
{
	"categories": [
		{
			"id": "grertgdfb53rg4",
			"name": "mantaqe 1",
			"cost": 3434.500
		},
		{
			"id": "btry5eb4rtgv4",
			"name": "mantaqe #2",
			"cost": 442.0
		}
	]
}
```

> **NOTE:**
>
>- **Pagination required.**

--------
###Get a single address category

 >```method: GET```
url: http://baseurl.tld/api/v1.8/customer/address/category/`{id}`/

response:
```
{
	"id": "grertgdfb53rg4",
	"name": "mantaqe 1",
	"cost": 3434.500
}
```
---------

##Customer API

###Add Customer

 >```method: POST```
url: http://baseurl.tld/api/v1.8/customer/

request:
```
{
  "name": "محمد رضا کمالی فرد",
  "note": "مشتری خیلی خوبیه",
  "type" : 1,
  "phones": [
    {
      "number": "۰۹۱۲۲۵۴۲۴۲۴",
      "note": "شماره همراه"
    },
    {
      "number": "۴۴۴۲۳۲۴۲",
      "note": "شماره منزل"
    }
  ],
  "people": [
    {
      "name": "محمد رضا کمالی فرد",
      "note": "کمالی فرد هستم",
      "title": "آقای",
      "addresses": [
        {
          "value": "پونک خیابان میرزابابایی خیابان عدل خیابان بهار شماره ۳۲",
          "category": "5557695e3cc19869977d8f15"
        },
        {
          "value": "تهران نیایش آشپزباشی ",
          "category": "5557695e3cc19869977d8f15"
        }
      ]
    }
  ]
}
```


response:
>Response is the ID of new customer
```
{
	"id": "55148eb63cc198e33ecd611c" #
}
```
> **NOTE:**
>
> - **type** code can be
>  - 0 *personal*
>  - 1 *company*

---

###Edit Customer

 >```method: PUT```
 
url: http://baseurl.tld/api/v1.2/customer/string:pk/

request:
```
{
  "name": "بهداد عابدی",
  "note": "مشتری خوبی بود",
  "phones": [
    {
      "id": "<phone_id>",
      "number": "09121900011",
      "note": "شماره همراه"
    },
    {
      "number": "02144202211",
      "note": "شماره منزل"
    }
  ],
  "people": [
    {
	  "id": "<people_id>",
      "name": "بهداد عابدی",
      "note": "مشتری اصلی ما است",
      "title": "آقای",
      "addresses": [
        {
          "value": "تهران شهران کوچه شماره ۲۲ خیابان یاسمن پلاک ۲",
          "category": "category_id"
        },
        {
          "value": "سعادت آباد میدان کتاب کترینگ آشپزباشی",
          "category": "category_id"
        }
      ]
    },
    {
      "name": "شهمیر",
      "title": "مهندس",
      "note": "دوست بهداد است برایش غذا میگیرد",
      "addresses": [
        {
          "value": "شهران خیابان دوم کوچه نیلوفر پلاک ۳۲۱",
          "category": "category_id"
        }
      ]
    }
  ]
}
```
> - Replace `string:pk` with customer id.
> - In nested documents (people and phone) field `id` is optional. If `id` exits new document will not be inserted into collection instead existing document will be edited and added to customer if it is not added.
> - response will be 202 if succeed.
> - response will be 404 if one of `id`s does not exist.

---
###Delete Customer

 >```method: DELETE```
url: http://baseurl.tld/api/v1.8/customer/`{id}`/

response will be 204 if succeed. otherwise 404

---

###Retrieve all Customers

 >```method: GET```
url: http://baseurl.tld/api/v1.8/customer/?per_page=`{per_page}`&page=`{page}`


response:

```
{
  "customers": [
    {
      "created_by": null,
      "created_on": "2014-12-13 13:58:34",
      "id": "548c460ab6851f20b89c8252",
      "is_active": true,
      "name": "حـضــوري",
      "note": null,
      "people": [
        {
          "address": [
            {
              "category": null,
              "value": "،،"
            }
          ],
          "created_by": null,
          "created_on": "2014-12-13 13:58:34",
          "id": "548c460ab6851f20b89c8251",
          "is_active": true,
          "name": "حـضــوري",
          "note": null,
          "title": null
        }
      ],
      "phones": [
        {
          "id": "548c460ab6851f20b89c8253",
          "is_active": true,
          "note": null,
          "number": "----------"
        }
      ]
    },
    {
      "created_by": null,
      "created_on": "2014-12-13 13:58:34",
      "id": "548c460ab6851f20b89c8255",
      "is_active": true,
      "name": "عباسي",
      "note": null,
      "people": [
        {
          "address": [
            {
              "category": null,
              "value": "وسک،ک 10،پ 30،واحد 4"
            }
          ],
          "created_by": null,
          "created_on": "2014-12-13 13:58:34",
          "id": "548c460ab6851f20b89c8254",
          "is_active": true,
          "name": "عباسي",
          "note": null,
          "title": null
        }
      ],
      "phones": [
        {
          "id": "548c460ab6851f20b89c8256",
          "is_active": true,
          "note": null,
          "number": "44320560"
        }
      ]
    },
    {
      "created_by": null,
      "created_on": "2014-12-13 13:58:34",
      "id": "548c460ab6851f20b89c8258",
      "is_active": true,
      "name": "وفايي",
      "note": null,
      "people": [
        {
          "address": [
            {
              "category": null,
              "value": "شاهين شمالي،کبيري طامه،اول 20 متري گلستان شرقي،12 متري نصرت،پ 39،طبقه 3 غربي"
            }
          ],
          "created_by": null,
          "created_on": "2014-12-13 13:58:34",
          "id": "548c460ab6851f20b89c8257",
          "is_active": true,
          "name": "وفايي",
          "note": null,
          "title": null
        }
      ],
      "phones": [
        {
          "id": "548c460ab6851f20b89c8259",
          "is_active": true,
          "note": null,
          "number": "44455597"
        }
      ]
    },
    {
      "created_by": null,
      "created_on": "2014-12-13 13:58:34",
      "id": "548c460ab6851f20b89c825b",
      "is_active": true,
      "name": "بهمني",
      "note": null,
      "people": [
        {
          "address": [
            {
              "category": null,
              "value": "عسگري،ک 11،پ 8،ساختمان نيلوفر،واحد 14،طبقه 2"
            }
          ],
          "created_by": null,
          "created_on": "2014-12-13 13:58:34",
          "id": "548c460ab6851f20b89c825a",
          "is_active": true,
          "name": "بهمني",
          "note": null,
          "title": null
        }
      ],
      "phones": [
        {
          "id": "548c460ab6851f20b89c825c",
          "is_active": true,
          "note": null,
          "number": "44326200"
        }
      ]
    },
    {
      "created_by": null,
      "created_on": "2014-12-13 13:58:34",
      "id": "548c460ab6851f20b89c825e",
      "is_active": true,
      "name": "برنج فروش - اصغري",
      "note": null,
      "people": [
        {
          "address": [
            {
              "category": null,
              "value": "شمال"
            }
          ],
          "created_by": null,
          "created_on": "2014-12-13 13:58:34",
          "id": "548c460ab6851f20b89c825d",
          "is_active": true,
          "name": "برنج فروش - اصغري",
          "note": null,
          "title": null
        }
      ],
      "phones": [
        {
          "id": "548c460ab6851f20b89c825f",
          "is_active": true,
          "note": null,
          "number": "9111912521"
        },
        {
          "id": "548c460ab6851f20b89c8260",
          "is_active": true,
          "note": null,
          "number": "1912223236"
        },
        {
          "id": "548c460ab6851f20b89c8261",
          "is_active": true,
          "note": null,
          "number": "9369497733"
        }
      ]
    }
  ],
  "meta": {
    "first": "http://127.0.0.1:5000/api/v1.8/customer/?per_page=5&page=1",
    "last": "http://127.0.0.1:5000/api/v1.8/customer/?per_page=5&page=1472",
    "next": "http://127.0.0.1:5000/api/v1.8/customer/?per_page=5&page=2",
    "page": 1,
    "pages": 1472,
    "per_page": 5,
    "prev": null,
    "total": 7357
  }
}
```

> **NOTE:**
>
>- **Pagination required.**

---

###GET a customer info

 >```method: GET```
*url: http://domainname.tld/api/v1.8/customer/string:pk/*
*url: http://domainname.tld/api/v1.8/customer/n/int:number/*

response:
```
{
  "active": true,
  "created_by": "admin",
  "created_on": "2015-05-16 20:56:22",
  "id": "5557aef63cc1986c18b524b6",
  "name": "محمد رضا کمالی فرد",
  "note": "مشتری خیلی خوبیه",
  "number": 16,
  "people": [
    {
      "active": true,
      "address": [
        {
          "category": {
            "active": true,
            "cost": 500.45,
            "id": "5557695e3cc19869977d8f15",
            "name": "manteqe 1"
          },
          "value": "پونک خیابان میرزابابایی خیابان عدل خیابان بهار شماره ۳۲"
        },
        {
          "category": {
            "active": true,
            "cost": 500.45,
            "id": "5557695e3cc19869977d8f15",
            "name": "manteqe 1"
          },
          "value": "تهران نیایش آشپزباشی "
        }
      ],
      "created_by": "admin",
      "created_on": "2015-05-16 20:56:22",
      "id": "5557aef63cc1986c18b524b9",
      "name": "محمد رضا کمالی فرد",
      "note": "کمالی فرد هستم",
      "title": "آقای"
    }
  ],
  "phones": [
    {
      "active": true,
      "id": "5557aef63cc1986c18b524b7",
      "note": "شماره همراه",
      "number": "۰۹۱۲۲۵۴۲۴۲۴"
    },
    {
      "active": true,
      "id": "5557aef63cc1986c18b524b8",
      "note": "شماره منزل",
      "number": "۴۴۴۲۳۲۴۲"
    }
  ],
  "type": 1
}
```

> **NOTE:**
>
> - There are two ways for this api. You can use mongodb id or customer number. If You want to use mongodb id replace *string:pk* with your specified item id. Otherwise replace *int:number* with your customer number.

----

###GET a customer report

 >```method: GET```
url: http://baseurl.tld/api/v1.8/customer/string:customer_id/report/?from=float:from_date&to=float:to_date

response:
```
{
  "customer": {
    "id": "55a5581f1b070821f36c5b8a",
    "name": 101,
    "number": 101
  },
  "orders": [
    "55a558201b070821f36c6111",
    "55a558211b070821f36c6159",
    "55a558211b070821f36c6195",
    "55a558211b070821f36c622f",
    "55a558211b070821f36c625b",
    "55a558221b070821f36c626a"
  ],
  "total_buy": 1332000,
  "total_payment": 1397355.6
}
```


> **NOTE:**
>
> - customer_id the mongo id of a customer.
> - from_date and to_date the time stamp of the report range time and should be a number and can be a float number. Default value is current time.
> - Current logged in user should have **CUSTOMER_REPORT**  ability to use this API otherwise response status code will be **403**.


---

###Search Customer

 >```method: POST```
url: http://baseurl.tld/api/v1.8/customer/search/

request:
```
{
    "query": "حس ام",
    "size": 50
}
```


response:

```
{
  "_shards": {
    "failed": 0,
    "successful": 5,
    "total": 5
  },
  "hits": {
    "hits": [
      {
        "_id": "55cb5f121b0708064cd79efe",
        "_index": "reyhoon",
        "_score": 4.4812403,
        "_source": {
          "name": "احسان طلوعی ",
          "note": "Maiores libero id."
        },
        "_type": "customer"
      },
      {
        "_id": "55cb62a21b07080794443821",
        "_index": "reyhoon",
        "_score": 4.3843904,
        "_source": {
          "name": "احسان عبدالعلی",
          "note": "Reprehenderit quam."
        },
        "_type": "customer"
      },
      {
        "_id": "55cb5f121b0708064cd79eb8",
        "_index": "reyhoon",
        "_score": 4.3672957,
        "_source": {
          "name": "احسان تهرانی",
          "note": "Minus accusamus."
        },
        "_type": "customer"
      },
      {
        "_id": "55cb62a21b07080794443847",
        "_index": "reyhoon",
        "_score": 4.349904,
        "_source": {
          "name": "جناب آقای احسان حمیدی",
          "note": "Adipisci dolor sit."
        },
        "_type": "customer"
      }
    ],
    "max_score": 4.4812403,
    "total": 4
  },
  "timed_out": false,
  "took": 12
}
```
> **NOTE:**
>
>  - To setup search first execute  `./run.py refresh_index` command.
>  - Set size field for return results array size. Default is 30 and maximum is 50.
> - Current logged in user should have **CUSTOMER_SEARCH**  ability to use this API otherwise response status code will be **403**.

---

###Search Person

 >```method: POST```
url: http://baseurl.tld/api/v1.8/customer/person/search/

request:
```
{
    "query": "Exceptur",
    "size": 50
}
```


response:

```
{
  "_shards": {
    "failed": 0,
    "successful": 5,
    "total": 5
  },
  "hits": {
    "hits": [
      {
        "_id": "55cb62a31b070807944438d4",
        "_index": "reyhoon",
        "_score": 5.1026435,
        "_source": {
          "name": "Excepturi ducimus.",
          "note": "Delectus error qui.",
          "title": "Dolores molestias."
        },
        "_type": "person"
      },
      {
        "_id": "55cb5f121b0708064cd79f03",
        "_index": "reyhoon",
        "_score": 5.0775375,
        "_source": {
          "name": "Aut excepturi minus.",
          "note": "Ut sed minus et.",
          "title": "Optio ab dolorem."
        },
        "_type": "person"
      },
      {
        "_id": "55cb62a21b07080794443820",
        "_index": "reyhoon",
        "_score": 5.0775375,
        "_source": {
          "name": "Facere excepturi.",
          "note": "Mollitia ipsa.",
          "title": "Illo eveniet aut."
        },
        "_type": "person"
      },
      {
        "_id": "55bde1e11b070805298f33f3",
        "_index": "reyhoon",
        "_score": 4.417726,
        "_source": {
          "name": "Eum odio quas saepe.",
          "note": "Laborum excepturi.",
          "title": "Voluptatibus."
        },
        "_type": "person"
      },
      {
        "_id": "55cb5f121b0708064cd79f13",
        "_index": "reyhoon",
        "_score": 4.417726,
        "_source": {
          "name": "Accusantium eaque.",
          "note": "Sunt rerum eius.",
          "title": "Quo excepturi qui."
        },
        "_type": "person"
      },
      {
        "_id": "55bde1e11b070805298f339f",
        "_index": "reyhoon",
        "_score": 4.4094963,
        "_source": {
          "name": "Deserunt eligendi.",
          "note": "Totam laborum.",
          "title": "Excepturi."
        },
        "_type": "person"
      },
      {
        "_id": "55cb5f111b0708064cd79e6b",
        "_index": "reyhoon",
        "_score": 4.4094963,
        "_source": {
          "name": "Quis est excepturi.",
          "note": "Omnis dolorem.",
          "title": "Quia error deleniti."
        },
        "_type": "person"
      },
      {
        "_id": "55cb5f121b0708064cd79e85",
        "_index": "reyhoon",
        "_score": 4.4094963,
        "_source": {
          "name": "Adipisci.",
          "note": "Excepturi omnis ex.",
          "title": "Dolorem quibusdam."
        },
        "_type": "person"
      }
    ],
    "max_score": 5.1026435,
    "total": 8
  },
  "timed_out": false,
  "took": 16
}
```
> **NOTE:**
>
>  - To setup search first execute  `./run.py refresh_index` command.
>  - Set size field for return results array size. Default is 30 and maximum is 50.
> - Current logged in user should have **CUSTOMER_SEARCH**  ability to use this API otherwise response status code will be **403**.

---
###Check for repeated numbers

 >```method: POST```
url: http://baseurl.tld/api/v1.8/customer/number/check/

request:
```
{
	"number" : "+989464918539"
}
```


response:

```

```
> **NOTE:**
>
>  - Response will be ``409`` in case of contact with this phone number exist and return Short info about customer in response.
>  - Response will be 204 if phone number doesn't exist.
> - Current logged in user should have **CUSTOMER_SEARCH**  ability to use this API otherwise response status code will be **403**.

---

##Item API

###API Add Item

 >```method: POST```
url: *http://baseurl.tld/api/v1.8/item/*

request:
```
{
  "name": "قرمه سبزی",
  "price": 2000,
  "note": "heelo",
  "details": ["bereshte", "noone ezafe", "abdar"],
  "category_name": "<ItemCategory mongodb id>",
  "printer": "<Printer mongodb id>"
}
```

> **NOTE:**
>
> - *printer* and *category_name* fields are optional.
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **ITEM_ADD**  ability to use this API otherwise response status code will be **403**.

---
###API Edit Item

 >```method: PUT```
url: *http://baseurl.tld/api/v1.8/item/string:pk/*

request:
```
{
  "name": "shiiiiiiiit",
  "price": 2000,
  "note": "heelo"
  "details": ["bereshte", "noone ezafe", "abdar"],
  "category_name": "<ItemCategory mongodb id>",
  "printer": "<Printer mongodb id>"
}
```

> **NOTE:**
>
> - *printer* and *category_name* fields are optional.
> - Replace string:pk with the user id you want to change his info
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **ITEM_EDIT**  ability to use this API otherwise response status code will be **403**.

---

###API Delete Item

 >```method: DELETE```
url: *http://baseurl.tld/api/v1.8/item/string:pk/*

> **NOTE:**
>
> - Replace string:pk with your specified item id.
> - Current logged in user should have **ITEM_DELETE**  ability to use this API otherwise response status code will be **403**.

---

###API Undelete Item

 >```method: PATCH```
url: *http://baseurl.tld/api/v1.8/item/string:pk/*

> **NOTE:**
>
> - Replace string:pk with your specified item id.
> - Current logged in user should have **ITEM_UNDELETE**  ability to use this API otherwise response status code will be **403**.

---
### API Get items info

 >```method: GET```
url: *http://baseurl.tld/api/v1.8/item/*
url: *http://baseurl.tld/api/v1.8/item/int:page/*

----
response:
```
{
  "items": [
    {
      "active": true,
      "category": null,
      "details": [],
      "id": "548afd70b6851f1e00cdab5a",
      "name": "shiiiiiiiit",
      "note": "heelo",
      "price": 2000
    },
    {
      "active": true,
      "category": {
        "active": true,
        "id": "548b0ba6b6851f0fd018ce4b",
        "name": "test cat",
        "note": "nothing important"
      },
      "details": [],
      "id": "548b0c1bb6851f0fd018ce4d",
      "name": "کباب",
      "note": "heelo",
      "price": 2000
    }
  ],
  "page": 1,
  "pages": 1
}
```

> **NOTE:**
>
>- **Pagination required.**
> - Replace int:page with page  number default is 1.
> - Current logged in user should have **ITEM_LIST**  ability to use this API otherwise response status code will be **403**.

---
### API Get items notes

 >```method: GET```
url: *http://baseurl.tld/api/v1.8/item/notes/*

----
response:
```
{ "notes": [ "salam" ] }
```
> **NOTE:**
>
> - Current logged in user should have **ITEM_LIST**  ability to use this API otherwise response status code will be **403**.

---
###API Get a item

 >```method: GET```
*url: http://domainname.tld/api/v1.8/item/string:pk/*
*url: http://domainname.tld/api/v1.8/item/n/int:number/*

response:
```
{
  "active": true,
  "category": {
    "active": true,
    "id": "548b0ba6b6851f0fd018ce4b",
    "name": "test cat",
    "note": "nothing important"
  },
  "details": [],
  "id": "548b0c1bb6851f0fd018ce4d",
  "name": "shoot",
  "note": "heelo",
  "price": 2000
}
```

> **NOTE:**
>
> - There are two ways for this api. You can use mongodb id or item number. If You want to use mongodb id replace *string:pk* with your specified item id. Otherwise replace *int:number* with your item number.
> - Current logged in user should have **ITEM_VIEW**  ability to use this API otherwise response status code will be **403**.

----
###GET an item report

 >```method: GET```
url: http://baseurl.tld/api/v1.8/item/string:item_id/report/?from=float:from_date&to=float:to_date

response:
```
{
  "item": {
    "id": "55a5581f1b070821f36c5a9d",
    "name": "Flora Klein"
  },
  "orders": [
    "55a558201b070821f36c610c",
    "55a558211b070821f36c612a",
    "55a558211b070821f36c612e",
    "55a558211b070821f36c6134",
    "55a558211b070821f36c614a",
    "55a558211b070821f36c614b",
    "55a558211b070821f36c615f",
    "55a558211b070821f36c6175",
    "55a558211b070821f36c618e",
    "55a558211b070821f36c6191",
    "55a558211b070821f36c61a6",
    "55a558211b070821f36c61a6",
    "55a558211b070821f36c61af",
    "55a558211b070821f36c61b0",
    "55a558211b070821f36c61b3",
    "55a558211b070821f36c61bf",
    "55a558211b070821f36c61d5",
    "55a558211b070821f36c61db",
    "55a558211b070821f36c61fb",
    "55a558211b070821f36c61ff",
    "55a558211b070821f36c6205",
    "55a558211b070821f36c6208",
    "55a558211b070821f36c620d",
    "55a558211b070821f36c6218",
    "55a558211b070821f36c6222",
    "55a558211b070821f36c6223",
    "55a558211b070821f36c6250",
    "55a558211b070821f36c6265",
    "55a558221b070821f36c6277",
    "55a558221b070821f36c6282",
    "55a558221b070821f36c6283"
  ],
  "total_sell": 527000
}
```


> **NOTE:**
>
> - item_id the mongo id of a item.
> - from_date and to_date the time stamp of the report range time and should be a number and can be a float number. Default value is current time.
> - Current logged in user should have **ITEM_REPORT**  ability to use this API otherwise response status code will be **403**.


---
###API Item Category
####API Add an Item Category

 >```method: POST```
url: *http://baseurl.tld/api/v1.8/item/category/*

request args:
```
{
  "name": "Item Cat #3",
  "note": "some notes"
}
```
> **NOTE:**
>
> - Current logged in user should have **ITEM_ADD**  ability to use this API otherwise response status code will be **403**.

---
####API Edit an Item Category

 >```method: PUT```
url: *http://baseurl.tld/api/v1.8/item/category/string:pk/*

request:
```
{
  "name": "Item Cat #3",
  "note": "some notes"
}
```
> **NOTE:**
>
> - Replace string:pk  with item category mongodb id.
> - Current logged in user should have **ITEM_EDIT**  ability to use this API otherwise response status code will be **403**.

---
####API Delete Item Categories

 >```method: DELETE```
url: *http://baseurl.tld/api/v1.8/item/category/string:pk/*

> **NOTE:**
>
> - Replace string:pk  with item category mongodb id.
> - Current logged in user should have **ITEM_DELETE**  ability to use this API otherwise response status code will be **403**.

---
####API Get Categories Info

 >```method: GET```
url: *http://baseurl.tld/api/v1.8/item/category/?per_page=`{per_page}`&page=`{page}`*

response:
```
{
    "categories": [
        {
            "id": "547b5eaadce3dc0c53a27dd6",
            "is_active": true,
            "name": "Item cat",
            "note": "item cate note"
        },
        {
            "id": "54816e0fdce3dc13c910b5c9",
            "is_active": false,
            "name": "Item Cat #3",
            "note": "خوب و خوشمزه"
        }
    ]
}
```

> **NOTE:**
>
>- **Pagination required.**
> - Replace string:pk  with item category mongodb id.
> - Current logged in user should have **ITEM_VIEW**  ability to use this API otherwise response status code will be **403**.

--------
####API retrieve a single Category

 >```method: GET```
url: *http://baseurl.tld/api/v1.8/item/category/string:pk/*

response:
```
{
    "id": "547b5eaadce3dc0c53a27dd6",
    "is_active": true,
    "name": "Item cat",
    "note": "item cate note"
}
```
> **NOTE:**
>
> - Replace string:pk  with item category mongodb id.
> - Current logged in user should have **ITEM_LIST**  ability to use this API otherwise response status code will be **403**.

---
####Get list of a category items

Resource URL
>GET
>**/item/category/item_cat_id/```string:pk```/**

> - Replace ```string:pk``` with your specified user id.


Resource Information
>|Response formats|Requires authentication?|Ability|
|:-:|:-:|:-:|
|JSON|YES|ITEM_LIST|

Example Result:
```

```


> **NOTE:**
>
>- **Pagination required.**
> - Current logged in user should have **ITEM_LIST**  ability to use this resource otherwise rejected and response status code will be **403**.

----------

## Order API

### API Add Order
> ```method: POST```
*url: http://domainname.tld/api/v1.8/order/*

request:
```
{
  "status": 1,
  "shift": 1,
  "sent_on": null,
  "customer": "<customer mongodb id>",
  "person": "<customer person mongodb id>",
  "agent": "<agent mongodb id>",
  "address": "Tehran, Iran, ...",
  "address_category": "<address category mongodb id>",
  "items": [
    {
      "count": 20,
      "item": "<item mongodb id>",
      "price": -1,
      "details": [
        "نون اضافه",
        "آب دار"
      ]
    }
  ],
  "cost": {
    "agent": <agent float>,
    "credit": <credit boolean>,
    "discount": <discount float>,
    "tax": <tax float>
  },
  "note": ""
}
```

> **NOTE:**
>
> - **status** code can be
>  - 0 *pending*
>  - 1 *accepted*
>  - 2 *delivered*
> - **shift** code can be
>  - 0 *morning*
>  - 1 *evening*
>  - 2 *night*
> - use **-1** for order item price to set default order item price.
> - **sent_on** field is optional and it's a date time field.
> - **agent** field is optional and should be field with agent mongod id.
> - **cost** field data should be like this:
>   - *agent* should be a float number equal or bigger than ***-1***. If you input  ***-1*** then the system calculate agent cost with default value.
>   - *credit* should be a boolean. Default value is ***False***. If you input ***True*** the system will calculate user credit and make it ***0*** and add it to cost calculating value.
>   - *tax* in percent(%) should be a float number equal or bigger than ***-1*** and equal or smaller than ***100***. If you input  ***-1*** then the system calculate tax cost with default value specified in settings.
>   - *discount* in percent(%) should be a float number equal or bigger than ***-1*** and equal or smaller than ***100***. If you input  ***-1*** then the system calculate discount cost with default value specified in person whose this order is belong to discount field.
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **ORDER_ADD**  ability to use this API otherwise response status code will be **403**.

----------
### API Get an Order
> ```method: GET```
*url: http://domainname.tld/api/v1.8/order/string:pk/*
*url: http://domainname.tld/api/v1.8/order/n/int:number/*

response:
```
{
  "agent": null,
  "cost": {
    "agent": 500,
    "credit": 200,
    "discount": 50,
    "payment_price": 2400,
    "tax": 50,
    "total_price": 2000
  },
  "created_by": "admin",
  "created_on": "Fri, 12 Dec 2014 14:37:01 GMT",
  "customer": {
    "id": "5480d7f3b6851f172cb183d1",
    "name": "حـضــوري"
  },
  "id": "548afd8eb6851f1e00cdab5c",
  "is_canceled": false,
  "items": [
    {
      "details": [
        "with sometthing"
      ],
      "id": "548afd70b6851f1e00cdab5a",
      "name": "کباب",
      "price": 2000
    }
  ],
  "note": null,
  "number": 1,
  "sent_on": null,
  "shift": 1,
  "status": 1,
  "address": "Tehran, Iran, ...",
  "address_category": "<address category mongodb id>"
}
```

> **NOTE:**
>
> - There are two ways for this api. You can use mongodb id or order number item. If You want to use mongodb id replace *string:pk* with your specified order id. Otherwise replace *int:number* with your order number.
> - Current logged in user should have **ORDER_VIEW**  ability to use this API otherwise response status code will be **403**.

----------
### API Assgin Order Agent
> ```method: PUT```
*url: http://domainname.tld/api/v1.8/order/string:pk/agent/*
*url: http://domainname.tld/api/v1.8/order/n/int:number/agent/*
response:
```
{
    "agent": "<mongodb agent id>"
}
```

> **NOTE:**
>
> - There are two ways for this api. You can use mongodb id or order number item. If You want to use mongodb id replace *string:pk* with your specified order id. Otherwise replace *int:number* with your order number.
> - Current logged in user should have **ORDER_EDIT**  ability to use this API otherwise response status code will be **403**.
> - If  you get response status code **404** it means whether order or agent does not exists.

----------
### API Get Order List with Info
> ```method: GET```
*url: http://domainname.tld/api/v1.8/order/*
*url http://domainname.tld/api/v1.8/order/bool:agent/*
*url http://domainname.tld/api/v1.8/order/bool:canceled/*
*url: http://domainname.tld/api/v1.8/order/int:page/*
*url: http://domainname.tld/api/v1.8/order/int:order_type/int:page/*

response:
```
{
  "order": [
    "-created_on"
  ],
  "orders": [
    {
      "agent": null,
      "cost": {
        "agent": 500,
        "credit": 200,
        "discount": 50,
        "payment_price": 2400,
        "tax": 50,
        "total_price": 2000
      },
      "created_by": "admin",
      "created_on": "Fri, 12 Dec 2014 14:37:01 GMT",
      "customer": {
        "id": "5480d7f3b6851f172cb183d1",
        "name": "حـضــوري"
      },
      "id": "548afd8eb6851f1e00cdab5c",
      "is_canceled": false,
      "address": "Mashad, Iran, ...",
	  "address_category": "<address category mongodb id>",
      "items": [
        {
          "details": [
            "with sometthing"
          ],
          "id": "548afd70b6851f1e00cdab5a",
          "name": "کباب",
          "price": 2000
        }
      ],
      "note": null,
      "number": 1,
      "sent_on": null,
      "shift": 1,
      "status": 1
    }
  ],
  "page": 1,
  "pages": 1
}
```

> **NOTE:**
>
>- **Pagination required.**
> - For now int:order_type can be this values:
>   - 1 *order by creation date*
>   - 2 *order by creation and sent on dates*
> - Default int:page and int:order_type values are 1.
> - Current logged in user should have **ORDER_LIST**  ability to use this API otherwise response status code will be **403**.
> - **Filtering result:** three parameters `bool:agent`, `bool:canceled` and `int:status` are optional. You can filter result by these parameters. If `agent` is `true` result will only contains order with agent and if it is `false` the result will only contains order without any agent assigned. These parameters can be used together too.

-------
### API Edit Order
> ```method: PUT```
*url: http://domainname.tld/api/v1.8/order/string:pk/*
*url: http://domainname.tld/api/v1.8/order/n/int:number/*

request:
```
{
  "sent_on": null,
  "status": 1,
  "shift": 1,
  "customer": "5480d7f3b6851f172cb183d1",
  "person": "<person mongodb id>",
  "address": "Mashad, Iran, ...",
  "address_category": "<address category mongodb id>",
  "items": [
    {
      "count": 21,
      "item": "548afd70b6851f1e00cdab5a",
      "price": <price float>,
      "details": [
        "with sometthing"
      ]
    }
  ],
  "cost": {
    "agent": <agent float>,
    "credit": <credit float>,
    "discount": <discount float>,
    "tax": <tax float>
  },
  "is_canceled": false
}
```
> **NOTE:**
>
> - There are two ways for this api. You can use mongodb id or order number item. If You want to use mongodb id replace *string:pk* with your specified order id. Otherwise replace *int:number* with your order number.
> - **cost** field data should be like this:
>   - *agent* should be a float number equal or bigger than ***0***.
>   - *credit* should be a float number equal or bigger than ***0***.
>   - *tax* in percent(%) should be a float number equal or bigger than ***0*** and equal or smaller than ***100***.
>   - *discount* in percent(%) should be a float number equal or bigger than ***0*** and equal or smaller than ***100***.
> - Current logged in user should have **ORDER_EDIT**  ability to use this API otherwise response status code will be **403**.

----------

### API Delete Order
> ```method: DELETE```
*url: http://domainname.tld/api/v1.8/order/string:pk/*
*url: http://domainname.tld/api/v1.8/order/n/int:number/*

> **NOTE:**
>
> - There are two ways for this api. You can use mongodb id or order number item. If You want to use mongodb id replace *string:pk* with your specified order id. Otherwise replace *int:number* with your order number.
> - Current logged in user should have **ORDER_DELETE**  ability to use this API otherwise response status code will be **403**.

----------

###Cancel an order
Resource URL
>DELETE
**/api/v1.8/order/string:pk/cancel/**

Resource Information
>|Response formats|Requires authentication?|
|:-:|:-:|
|JSON|YES


> **NOTE:**
>
> - Replace *string:pk* with your specified order id.
>- If the order is already canceled response status code will be **406**.
>- If there is no order with specified id response status code will be **404**.

----------


### API Undelete Order
> ```method: PATCH```
*url: http://domainname.tld/api/v1.8/order/string:pk/*
*url: http://domainname.tld/api/v1.8/order/n/int:number/*

> **NOTE:**
>
> - There are two ways for this api. You can use mongodb id or order number item. If You want to use mongodb id replace *string:pk* with your specified order id. Otherwise replace *int:number* with your order number.
> - Current logged in user should have **ORDER_UNDELETE**  ability to use this API otherwise response status code will be **403**.


### API Print Order

> ```method: GET```
*url: http://domainname.tld/api/v1.8/order/string:pk/print/*

> **NOTE:**
>
> - replace *string:pk* with your specified order id.
> - Current logged in user should have **ORDER_PRINT**  ability to use this API otherwise response status code will be **403**.

----------

### API Print Preview Order

> ```method: GET```
*url: http://domainname.tld/api/v1.8/order/string:pk/print/preview/*

> **NOTE:**
>
> - replace *string:pk* with your specified order id.
> - Current logged in user should have **ORDER_PRINT**  ability to use this API otherwise response status code will be **403**.

----------
### API Restart Order Number

> ```method: PUT```
*url: http://domainname.tld/api/v1.8/order/number/*

> **NOTE:**
>
> - This API restarts order counter to 1. Can be used for shift change.
> - Current logged in user should have **ORDER_RESTART_NUMBER**  ability to use this API otherwise response status code will be **403**
> - In case of server error response status code will be **406**

----------

## Agent API

### API Add Agent
> ```method: POST```
*url: http://domainname.tld/api/v1.8/agent/*

request:
```
{
  "name": "new agent name",
  "address": "tehran, ...",
  "phone": "09308181811",
  "note": "hi"
}
```

> **NOTE:**
>
> - **name** and **phone** fields are required.
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **AGENT_ADD**  ability to use this API otherwise response status code will be **403**.

-------
### API Edit Agent
> ```method: PUT```
*url: http://domainname.tld/api/v1.8/agent/string:pk/*

request:
```
{
  "name": "new agent name",
  "address": "tehran, ...",
  "phone": "09308181811",
  "note": "hi"
}
```

> **NOTE:**
>
> - Replace string:pk with your specified agent id.
> - **name** and **phone** fields are required.
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **AGENT_EDIT**  ability to use this API otherwise response status code will be **403**.

-------
### API Delete Agent
> ```method: DELETE```
*url: http://domainname.tld/api/v1.8/agent/string:pk/*

> **NOTE:**
>
> - Replace string:pk with your specified agent id.
> - Current logged in user should have **AGENT_DELETE**  ability to use this API otherwise response status code will be **403**.

-------
### API Get Agent
> ```method: GET```
*url: http://domainname.tld/api/v1.8/agent/string:pk/*

response:
```
{
  "active": false,
  "address": "tehran, ...",
  "created_by": "admin",
  "created_on": "Fri, 12 Dec 2014 13:39:57 GMT",
  "id": "548af02db6851f199c7565aa",
  "name": "new agent name",
  "note": "you where edited ",
  "phone": "09308181811"
}
```
> **NOTE:**
>
> - Replace string:pk with your specified agent id.
> - Current logged in user should have **AGENT_VIEW**  ability to use this API otherwise response status code will be **403**.

-------

###Get list of all agents with info
> ```method: Get```
*url: http://domainname.tld/api/v1.8/agent/*

response:
```
{
  "agents": [
    {
      "active": true,
      "address": "",
      "created_by": "admin",
      "created_on": "2015-01-24 13:05:58",
      "id": "54c398b6b6851f230c89f5c4",
      "name": "خلیل پشمک",
      "note": "",
      "phone": "09308181811"
    },
    {
      "active": true,
      "address": "",
      "created_by": "admin",
      "created_on": "2014-12-13 14:04:36",
      "id": "548c4774b6851f2a2022b786",
      "name": "محمد رضا",
      "note": "",
      "phone": "09308181811"
    }
  ],
  "meta": {
    "first": "http://127.0.0.1:5000/api/v1.8/agent/?per_page=25&page=1",
    "last": "http://127.0.0.1:5000/api/v1.8/agent/?per_page=25&page=1",
    "next": null,
    "page": 1,
    "pages": 1,
    "per_page": 25,
    "prev": null,
    "total": 2
  }
}
```
> **NOTE:**
>
>- **Pagination required.**
> - Replace int:page with page  number default is 1.
> - Current logged in user should have **AGENT_LIST**  ability to use this API otherwise response status code will be **403**.

----
###GET an agent report

 >```method: GET```
url: http://baseurl.tld/api/v1.8/agten/string:agent_id/report/?from=float:from_date&to=float:to_date

response:
```
{
  "agent": {
    "id": "55a5581f1b070821f36c5ac0",
    "name": "Linwood Adams"
  },
  "orders": [
    "55a558211b070821f36c61cf",
    "55a558211b070821f36c61d0",
    "55a558211b070821f36c61d9",
    "55a558211b070821f36c61da",
    "55a558221b070821f36c628a",
    "55a558221b070821f36c628d",
    "55a558221b070821f36c6290",
    "55a558221b070821f36c6291"
  ],
  "total_paid_to": 21762601,
  "total_sell": 20904000
}
```


> **NOTE:**
>
> - agent_id the mongo id of a agent.
> - from_date and to_date the time stamp of the report range time and should be a number and can be a float number. Default value is current time.
> - Current logged in user should have **AGENT_REPORT**  ability to use this API otherwise response status code will be **403**.


------

## Setting API

### Set Setting
> ```method: PUT```
*url: http://domainname.tld/api/v1.8/setting/string:name/*

request:
```
{
  "value": "any kind of valid data such as numbers, strings, json"
}
```

> **NOTE:**
>
> - name is setting key name.
> - Current logged in user should have **SETTING_EDIT**  ability to use this API otherwise response status code will be **403**.

### Get Setting
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/string:name/*

response:
```
{
  "value": "any kind of valid data such as numbers, strings, json"
}
```

> **NOTE:**
>
> - name is setting key name.
> - Current logged in user should have **SETTING_VIEW**  ability to use this API otherwise response status code will be **403**.

-------

### Delete Setting
> ```method: DELETE```
*url: http://domainname.tld/api/v1.8/setting/string:name/*

request:
```
{
  "confirm": true
}
```

> **NOTE:**
>
> - name is setting key name.
> - Delete setting if you want to set it to default value.
> - Current logged in user should have **SETTING_DELETE**  ability to use this API otherwise response status code will be **403**.

-------

### List Settings
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/*

response:
```
{
  "settings": [
    {
      "modified": "Sun, 26 Jul 2015 20:49:14 GMT",
      "name": "tax",
      "value": 0
    }
  ]
}
```

> **NOTE:**
>
> - Current logged in user should have **SETTING_LIST**  ability to use this API otherwise response status code will be **403**.

-------

### Get time
> ```method: GET/PUT```
*url: http://domainname.tld/api/v1.8/setting/time/*

response:
```
{
  "name": "time",
  "value": 1437075146
}
```

> **NOTE:**
>
> - Current logged in user should have **SETTING_VIEW**  ability to use this API otherwise response status code will be **403**.

-------
### Printer

#### Get printer sources
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/printer/sources/*

response:
```
{
  "sources": [
    "Canon_LBP3010_LBP3018_LBP3050"
  ]
}
```

> **NOTE:**
>
> - Get system printers using this API.
> - Current logged in user should have **SETTING_PRINTER_LIST**  ability to use this API otherwise response status code will be **403**.

-------

#### Get printers
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/printer/*

response:
```
{
  "printers": [
    {
      "active": true,
      "copies": 1,
      "id": "55dba6011b07082398646440",
      "label": "TestEdit",
      "source": "Canon_LBP3010_LBP3018_LBP3050"
    }
  ]
}
```

> **NOTE:**
>
> - Get virtual printers using this API.
> - Current logged in user should have **SETTING_PRINTER_LIST**  ability to use this API otherwise response status code will be **403**.

-------

#### Get printer
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/printer/string:printer/*

response:
```
{
  "active": true,
  "copies": 1,
  "id": "55dba6011b07082398646440",
  "label": "TestEdit",
  "source": "Canon_LBP3010_LBP3018_LBP3050"
}
```

> **NOTE:**
>
> - name is printer mongodb id.
> - Get a virtual printer by id using this API.
> - Current logged in user should have **SETTING_PRINTER_VIEW**  ability to use this API otherwise response status code will be **403**.

-------
#### Add printer
> ```method: POST```
*url: http://domainname.tld/api/v1.8/setting/printer/*

request:
```
{
    "source": "Canon_LBP3010_LBP3018_LBP3050",
    "label": "TestEdit",
    "copies": 1
}
```

> **NOTE:**
>
> - Get sources field choices from get printer sources API.
> - Add a virtual printer by id using this API.
> - Current logged in user should have **SETTING_PRINTER_ADD**  ability to use this API otherwise response status code will be **403**.

-------

#### Edit printer
> ```method: PUT```
*url: http://domainname.tld/api/v1.8/setting/printer/string:name/*

request:
```
{
    "source": "Canon_LBP3010_LBP3018_LBP3050",
    "label": "TestEdit",
    "copies": 1
}
```

> **NOTE:**
>
> - name is printer mongodb id.
> - Get sources field choices from get printer sources API.
> - Edit a virtual printer by id using this API.
> - Current logged in user should have **SETTING_PRINTER_EDIT**  ability to use this API otherwise response status code will be **403**.

-------

####  Delete printer
> ```method: PUT```
*url: http://domainname.tld/api/v1.8/setting/printer/string:name/*


> **NOTE:**
>
> - name is printer mongodb id.
> - Get sources field choices from get printer sources API.
> - Delete a virtual printer by id using this API.
> - Current logged in user should have **SETTING_PRINTER_DELETE**  ability to use this API otherwise response status code will be **403**.

-----

### Backup Settings
> ```method: POST```
*url: http://domainname.tld/api/v1.8/setting/backup/*

response:
```
{
  "time": 1437075146
}
```

> **NOTE:**
> 
> - Current logged in user should have **SETTING_DATA_BACKUP**  ability to use this API otherwise response status code will be **403**.

-------

### Restore Settings
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/restore/int:time/*

> **NOTE:**
> 
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **SETTING_DATA_RESTORE**  ability to use this API otherwise response status code will be **403**.

-------

### Get list of backups
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/backup/*


response:
```
{
  "backups": [
     1438650668,
     1438650673,
     1438651122
  ]
}
```

> **NOTE:**
> 
> - Current logged in user should have **SETTING_BACKUP_LIST**  ability to use this API otherwise response status code will be **403**.

-------

### Delete a backup
> ```method: DELETE```
*url: http://domainname.tld/api/v1.8/setting/backup/int:time/*


> **NOTE:**
> 
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **SETTING_BACKUP_DELETE**  ability to use this API otherwise response status code will be **403**.

-------

### Download a backup
> ```method: GET```
*url: http://domainname.tld/api/v1.8/setting/backup/download/int:time/*


> **NOTE:**
> 
> - If there are errors then response status code will be **406**.
> - Current logged in user should have **SETTING_BACKUP_DOWNLOAD**  ability to use this API otherwise response status code will be **403**.

-------

### Upload a backup
> ```method: POST```
*url: http://domainname.tld/api/v1.8/setting/backup/upload/int:time/*


> **NOTE:**
> 
> - Current logged in user should have **SETTING_BACKUP_UPLOAD**  ability to use this API otherwise response status code will be **403**.

-------

##Phone

> ```mimetype: text/event-stream```
> ```method: GET```
*url: http://domainname.tld/api/v1.8/phone/?port=string&baud_rate=int*

Example Request
```
url: http://domainname.tld/api/v1.8/phone/?port=/dev/tty.usbserial-AI028F8T&baud_rate=9600
```


Event:  **status**
```
  data:
  {
    "error": "device not found"
  }
  data:
  {
    "error": "device disconnected"
  }
  data:
  {
    "error": "incorrect baud rate"
  }
```

Event:  **discovery**
```
  data:
  {
    "line": 1,
    "number":"+989125687945", 
    "date":"2015-08-14 10:47:16", 
    "customer_id": null
  }
```

Event:  **ringing**
```
  data:
  {
    "line": 1,
    "count": 5
  }
```

> **NOTE:**
> 
> - Default value for "port" is "/dev/ttyUSB0".
> - Default value for "baud_rate" is 115200.
> - Response is a stream.
> - Status event occurs when device not found, disconnected or the baud rate is incorrect.
> - Discovery event occurs when first time phone rings.
> - Ringing event occurs while phone rings. "count" is the rings count.
> - Root permission is required to use this API.

-------

### Get call report
 >```method: GET```
*url: http://baseurl.tld/api/v1.8/phone/report/?from=float:from_date&to=float:to_date*

Example Request
```
url: http://baseurl.tld/api/v1.8/phone/report/?from=1439531000&to=1439535000
```

Example Result
```
{
  "calls": [
    {
      "date": "2015-08-14 10:44:18",
      "line": 4,
      "customer_id": null,
      "number": "+9822365299"
    },
    {
      "date": "2015-08-14 10:44:18",
      "line": 1,
      "customer_id": "55ccfd487431e9591c9fcdf8",
      "number": "+989123041726"
    },
    {
      "date": "2015-08-14 10:47:00",
      "line": 3,
      "customer_id": null,
      "number": "+9822351556"
    },
    {
      "date": "2015-08-14 10:47:16",
      "line": 4,
      "customer_id": null,
      "number": "+9822359712"
    }
  ]
}
```

> **NOTE:**
> 
> - Default value for "from" is 0.
> - Default value for "to" is current time.
> - Current logged in user should have **PHONE_REPORT**  ability to use this API otherwise response status code will be **403**.

-------

### Get list of available serial ports and baud rates
 >```method: GET```
*url: http://baseurl.tld/api/v1.8/phone/list/*

Example Result
```
{
  "baud_rates": [
    0, 50, 75, 110, 134, 150, 200, 300, 600, 1200, 
    1800, 2400, 4800, 9600, 19200, 38400, 57600, 
    115200, 230400, 460800, 576000, 921600
  ],
  "ports": [
    "/dev/ttyUSB0"
  ]
}
```

> **NOTE:**
> 
> - Current logged in user should have **PHONE_LIST**  ability to use this API otherwise response status code will be **403**.

-------

